### Initial init.qcom.rc config

on charger
    write /sys/devices/system/cpu/cpu2/online 0
    write /sys/devices/system/cpu/cpu3/online 0
    write /sys/devices/system/cpu/cpu0/cpufreq/ "powersave"
    write /sys/module/lpm_levels/parameters/sleep_disabled 0
    wait /dev/block/bootdevice

on early-boot
    # Set aggressive read ahead during boot up
    write /sys/class/i2c-dev/i2c-6/device/6-0072/enable_irq 1

on init
    write /proc/sys/kernel/panic_on_oops 1
    write /proc/sys/vm/max_map_count 1000000

on boot
    # Set permissions by node reads by dumpstate
    chmod 0644 /sys/devices/system/cpu/present
    chmod 0644 /sys/devices/system/cpu/online

    # Wifi firmware reload path
    chown wifi wifi /sys/module/bcmdhd/parameters/firmware_path

    start vendor.rmt_storage
    start vendor.rfs_access
    # access permission for secure touch
    chmod 0660 /sys/devices/soc/75ba000.i2c/i2c-12/12-004a/secure_touch_enable
    chmod 0440 /sys/devices/soc/75ba000.i2c/i2c-12/12-004a/secure_touch
    chown system drmrpc /sys/devices/soc/75ba000.i2c/i2c-12/12-004a/secure_touch_enable
    chown system drmrpc /sys/devices/soc/75ba000.i2c/i2c-12/12-004a/secure_touch
    write /sys/devices/soc/75ba000.i2c/i2c-12/12-0020/input/input0/update_fw 1

    # Create QMUX deamon socket area
    mkdir /dev/socket/qmux_audio 0770 media audio
    chmod 2770 /dev/socket/qmux_audio
    mkdir /dev/socket/qmux_bluetooth 0770 bluetooth bluetooth
    chmod 2770 /dev/socket/qmux_bluetooth
    mkdir /dev/socket/qmux_gps 0770 gps gps
    chmod 2770 /dev/socket/qmux_gps

    mkdir /persist/bluetooth 0770 bluetooth bluetooth
    mkdir /persist/alarm 0770 system system
    mkdir /persist/time 0770 system system
    mkdir /persist/rfs 0770 system system
    mkdir /persist/hlos_rfs 0770 system system

    # Create NETMGR daemon socket area
    mkdir /dev/socket/netmgr 0750 radio radio

    # For bridgemgr daemon to inform the USB driver of the correct transport
    chown radio radio /sys/class/android_usb/f_rmnet_smd_sdio/transport

    #   Assign TCP buffer thresholds to be ceiling value of technology maximums
    #   Increased technology maximums should be reflected here.
    write /proc/sys/net/core/rmem_max  8388608
    write /proc/sys/net/core/wmem_max  8388608

    # To allow interfaces to get v6 address when tethering is enabled
    write /proc/sys/net/ipv6/conf/default/accept_ra_defrtr 1
    write /proc/sys/net/ipv6/conf/rmnet0/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet1/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet2/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet3/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet4/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet5/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet6/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet7/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_sdio0/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_sdio1/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_sdio2/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_sdio3/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_sdio4/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_sdio5/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_sdio6/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_sdio7/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_usb0/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_usb1/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_usb2/accept_ra 2
    write /proc/sys/net/ipv6/conf/rmnet_usb3/accept_ra 2

    # Touch gestures
    chown system system /sys/devices/virtual/input/lge_touch/keyguard
    chmod 664 /sys/devices/virtual/input/lge_touch/keyguard
    chown system system /sys/devices/virtual/input/lge_touch/lpwg_data
    chmod 664 /sys/devices/virtual/input/lge_touch/lpwg_data
    chown system system /sys/devices/virtual/input/lge_touch/lpwg_notify
    chmod 664 /sys/devices/virtual/input/lge_touch/lpwg_notify
    chown system system /sys/devices/virtual/input/lge_touch/quick_cover_status
    chmod 664 /sys/devices/virtual/input/lge_touch/quick_cover_status
    chown system system /sys/devices/virtual/input/lge_touch/q_sensitivity
    chmod 664 /sys/devices/virtual/input/lge_touch/q_sensitivity
    chown system system /sys/devices/virtual/input/lge_touch/incoming_call
    chmod 664 /sys/devices/virtual/input/lge_touch/incoming_call
    chown system system /sys/devices/virtual/input/lge_touch/ime_status
    chmod 664 /sys/devices/virtual/input/lge_touch/keyguard
    chown system system /sys/devices/virtual/input/lge_touch/debug_tool
    chmod 664 /sys/devices/virtual/input/lge_touch/debug_tool
    chown system system /sys/devices/virtual/input/lge_touch/debug_option
    chmod 664 /sys/devices/virtual/input/lge_touch/debug_option
    chown system system /sys/devices/virtual/input/lge_touch/onhand
    chmod 664 /sys/devices/virtual/input/lge_touch/onhand
    chown system radio /sys/devices/virtual/input/lge_touch/tap2wake
    chmod 664 /sys/devices/virtual/input/lge_touch/tap2wake

    # External Display Watch
    chown system system /sys/devices/virtual/ext_watch/config_fontonoff
    chmod 664 /sys/devices/virtual/ext_watch/config_fontonoff
    chown system system /sys/devices/virtual/ext_watch/config_fontdata
    chmod 664 /sys/devices/virtual/ext_watch/config_fontdata
    chown system system /sys/devices/virtual/ext_watch/config_fonteffect
    chmod 664 /sys/devices/virtual/ext_watch/config_fonteffect
    chown system system /sys/devices/virtual/ext_watch/config_fontproperty
    chmod 664 /sys/devices/virtual/ext_watch/config_fontproperty
    chown system system /sys/devices/virtual/ext_watch/config_fontposition
    chmod 664 /sys/devices/virtual/ext_watch/config_fontposition
    chown system system /sys/devices/virtual/ext_watch/config_timesync
    chmod 664 /sys/devices/virtual/ext_watch/config_timesync
    chown system system /sys/devices/virtual/ext_watch/query_fontdata
    chmod 664 /sys/devices/virtual/ext_watch/query_fontdata
    chown system system /sys/devices/virtual/ext_watch/query_fontposition
    chmod 664 /sys/devices/virtual/ext_watch/query_fontposition
    chown system system /sys/devices/virtual/ext_watch/query_timesync
    chmod 664 /sys/devices/virtual/ext_watch/query_timesync
    chown system system /sys/devices/virtual/ext_watch/query_fontcolor
    chmod 664 /sys/devices/virtual/ext_watch/query_fontcolor
    chown system system /sys/devices/virtual/ext_watch/query_fonteffect
    chmod 664 /sys/devices/virtual/ext_watch/query_fonteffect

    # Always on Display
    chown system system /sys/class/graphics/fb0/aod
    chmod 664 /sys/class/graphics/fb0/aod
    chown system system /sys/class/graphics/fb0/keep_aod
    chmod 664 /sys/class/graphics/fb0/keep_aod
    chown system system /sys/class/graphics/fb0/cur_panel_mode
    chmod 644 /sys/class/graphics/fb0/cur_panel_mode
    chown system system /sys/class/leds/lcd-backlight-ex/brightness
    chmod 664 /sys/class/leds/lcd-backlight-ex/brightness
    chown system system /system/bin/AODLayer
    chmod 664 /system/bin/AODLayer

    # High Luminance Mode
    chown system system /sys/devices/virtual/graphics/fb0/hl_mode
    chmod 664 /sys/devices/virtual/graphics/fb0/hl_mode

    # Thermal BL Max
    chown system system /sys/devices/virtual/graphics/fb0/thermal_blmax
    chmod 664 /sys/devices/virtual/graphics/fb0/thermal_blmax

    # Image Tune
    chown system system /sys/class/panel/img_tune/sharpness
    chown system system /sys/class/panel/img_tune/color_enhancement
    chown system system /sys/class/panel/img_tune/image_enhance_set
    chown system system /sys/class/panel/img_tune/cabc
    chmod 664 /sys/class/panel/img_tune/sharpness
    chmod 664 /sys/class/panel/img_tune/color_enhancement
    chmod 664 /sys/class/panel/img_tune/image_enhance_set
    chmod 664 /sys/class/panel/img_tune/cabc

    # Vibrator adjustment
    chown system system /sys/class/timed_output/vibrator/amp
    chmod 664 /sys/class/timed_output/vibrator/amp

    # Fingerprints
    chown system input /sys/devices/virtual/input/lge_fingerprint/testmode
    chown system input /sys/devices/virtual/input/lge_fingerprint/spitest
    chown system input /sys/devices/virtual/input/lge_fingerprint/zonetest
    chown system input /sys/devices/virtual/input/lge_fingerprint/checkerbdtest
    chown system input /sys/devices/virtual/input/lge_fingerprint/rubbertest
    chown system input /sys/devices/virtual/input/lge_fingerprint/intstatus
    chown system input /sys/devices/virtual/input/lge_fingerprint/qup_id
    chown system input /sys/devices/virtual/input/lge_fingerprint/waitfinger
    chown system input /sys/devices/virtual/input/lge_fingerprint/spi_prepare
    chmod 0660 /sys/devices/virtual/input/lge_fingerprint/testmode
    chmod 0660 /sys/devices/virtual/input/lge_fingerprint/spitest
    chmod 0660 /sys/devices/virtual/input/lge_fingerprint/zonetest
    chmod 0660 /sys/devices/virtual/input/lge_fingerprint/checkerbdtest
    chmod 0660 /sys/devices/virtual/input/lge_fingerprint/rubbertest
    chmod 0440 /sys/devices/virtual/input/lge_fingerprint/intstatus
    chmod 0660 /sys/devices/virtual/input/lge_fingerprint/qup_id
    chmod 0220 /sys/devices/virtual/input/lge_fingerprint/waitfinger
    chmod 0660 /sys/devices/virtual/input/lge_fingerprint/spi_prepare
    chown system input /sys/bus/spi/devices/spi8.1/bus_lock
    chown system input /sys/bus/spi/devices/spi8.1/clk_enable
    chown system input /sys/bus/spi/devices/spi8.1/fabric_vote
    chown system input /sys/bus/spi/devices/spi8.1/hw_reset
    chown system input /sys/bus/spi/devices/spi8.1/irq
    chown system input /sys/bus/spi/devices/spi8.1/pinctl_set
    chown system input /sys/bus/spi/devices/spi8.1/spi_prepare
    chown system input /sys/bus/spi/devices/spi8.1/spi_owner
    chown system input /sys/bus/spi/devices/spi8.1/regulator_enable
    chown system input /sys/bus/spi/devices/spi8.1/wakeup_enable

    write /proc/sys/net/core/netdev_max_backlog 5000

# MSM specific files that need to be created on /data
on post-fs-data

    #Create directories for Fingerprint
    mkdir /data/vendor/misc/qti_fp 0770 system system
    mkdir /data/vendor/misc/qti_fp/bg_estimation 0770 system system
    mkdir /data/vendor/misc/qti_fp/calib_test 0770 system system
    mkdir /data/vendor/misc/qti_fp/database 0770 system system

    # create QDMA dropbox
    mkdir /data/vendor/qdmastats 0700 system system
    mkdir /data/vendor/qdma 0770 system system
    mkdir /dev/socket/qdma 0777 system system
    chmod 2777 /dev/socket/qdma

    # Create folder for mm-qcamera-daemon
    mkdir /data/media 0770 media_rw media_rw
    chown media_rw media_rw /data/media

    mkdir /data/misc/bluetooth 0770 bluetooth bluetooth
    mkdir /data/vendor/misc/bluetooth 0770 bluetooth bluetooth
    chmod 0644 /data/misc/bluetooth/bdaddr
    chown bluetooth bluetooth /data/misc/bluetooth/bdaddr
    chmod 0644 /persist/.baddr
    chown system system /persist/.baddr

    # Create the directories used by the Wireless subsystem
    mkdir /data/misc/dhcp 0770 dhcp dhcp
    chown dhcp system /data/misc/dhcp
    chmod 0644 /data/misc/wifi/config
    chown system wifi /data/misc/wifi/config
    chmod 0644 /persist/.macaddr
    chown system system /persist/.macaddr

    # Create port-bridge log dir
    mkdir /data/vendor/port_bridge 0770 radio radio
    chmod 0770 /data/vendor/port_bridge

    # Create netmgr log dir
    mkdir /data/vendor/netmgr 0770 radio radio
    chmod 0770 /data/vendor/netmgr

    # Create ipacm log dir
    mkdir /data/vendor/ipa 0770 radio radio
    chmod 0770 /data/vendor/ipa

    # Create directory used by audio subsystem
    mkdir /data/vendor/misc/audio 0770 audio audio

    # Create directory for audio delta files
    mkdir /data/vendor/misc/audio/acdbdata 0770 media audio
    mkdir /data/vendor/misc/audio/acdbdata/delta 0770 media audio

    # Configure bluetooth
    chmod 0660 /proc/bluetooth/sleep/lpm
    chmod 0660 /proc/bluetooth/sleep/btwrite
    chown bluetooth bluetooth /proc/bluetooth/sleep/lpm
    chown bluetooth bluetooth /proc/bluetooth/sleep/btwrite

    # Make sure the default firmware is loaded
    write /sys/module/bcmdhd/parameters/firmware_path "/vendor/firmware/fw_bcmdhd.bin"
    write /sys/module/bcmdhd/parameters/nvram_path "/vendor/etc/wifi/bcmdhd.cal"

    mkdir /data/vendor/audio/ 0770 media audio

    # Create PERFD deamon related dirs
    setprop ro.min_freq_0 384000
    mkdir /data/misc/perfd 0755 root system
    chmod 2755 /data/misc/perfd

    # NFC local data and nfcee xml storage
    mkdir /data/vendor/nfc 0770 nfc nfc
    mkdir /data/vendor/nfc/param 0770 nfc nfc

    chown system system /sys/class/kgsl/kgsl-3d0/devfreq/max_freq
    chmod 0660 /sys/class/kgsl/kgsl-3d0/devfreq/max_freq
    chown system system /sys/class/kgsl/kgsl-3d0/devfreq/min_freq
    chmod 0660 /sys/class/kgsl/kgsl-3d0/devfreq/min_freq
    chown system system /sys/class/devfreq/soc:qcom,gpubw/min_freq
    chmod 0660 /sys/class/devfreq/soc:qcom,gpubw/min_freq

    # Persist LG folders
    mkdir /persist-lg/property 0771 system radio
    mkdir /persist-lg/autosimlock 0770 system system
    mkdir /persist-lg/poweron 0775 system system
    mkdir /persist-lg/tmo 0771 radio radio
    mkdir /persist-lg/callfw 0770 radio radio
    mkdir /persist-lg/kmstore 0770 system system
    mkdir /persist-lg/lgdata 0771 radio radio
    mkdir /persist-lg/lgdrm 0770 lgdrm lgdrm_acc
    mkdir /persist-lg/widevine 0770 drm system
    mkdir /persist-lg/firmware 0771 system system
    mkdir /persist-lg/secclk 0700 system system
    mkdir /persist-lg/chargerlogo 0770 system system
    mkdir /persist-lg/multimedia 0770 media divxdrm
    mkdir /persist-lg/multimedia/nx 0770 media divxdrm
    mkdir /persist-lg/multimedia/uma 0770 media divxdrm
    mkdir /persist-lg/multimedia/scnt 0770 media divxdrm
    mkdir /persist-lg/multimedia/scnt/sdadf 0770 media divxdrm
    mkdir /persist-lg/mms 0770 system lgmms
    mkdir /persist-lg/mmoprt 0771 system system
    mkdir /persist-lg/encryption 0771 system system
    mkdir /persist-lg/secureks 0770 system system
    mkdir /persist-lg/lgdata 0775 radio radio
    mkdir /persist-lg/audio 0771 system system
    mkdir /persist-lg/property 0771 system radio
    chown media media /persist-lg/audio

    # Thermal Daemon
    chown system system /sys/class/leds/lcd-backlight/thermald_status
    chmod 0644 /sys/class/leds/lcd-backlight/thermald_status

on post-fs
    chmod 0660 /dev/lge_dm_tty0
    chown system system /dev/lge_dm_tty0

    mkdir /sns/cal/ 0755 system system
    mkdir /sns/fingerprint/ 0775 system system

service vendor.conn_init /vendor/bin/hwaddrs
    class core
    user root
    group system wifi bluetooth
    oneshot

on property:init.svc.vendor.conn_init=stopped
    chmod 0644 /data/misc/wifi/config
    chown system wifi /data/misc/wifi/config
    chmod 0644 /data/misc/bluetooth/bdaddr
    chown bluetooth bluetooth /data/misc/bluetooth/bdaddr

on property:vold.decrypt=trigger_restart_framework
    restart vendor.audio-hal-2-0
    restart vendor.camera-provider-2-4
    start config_bt_addr
    start config_bluetooth

service vendor.cnd /vendor/bin/cnd
    class main
    user system
    group system wifi inet radio wakelock net_admin
    writepid /dev/cpuset/system-background/tasks

service vendor.dpmd /vendor/bin/dpmd
    class late_start
    socket dpmd stream 660 root system
    group system readproc
    writepid /dev/cpuset/system-background/tasks
    disabled

service vendor.rmt_storage /vendor/bin/rmt_storage
    class core
    user root
    writepid /dev/cpuset/system-background/tasks

service vendor.rfs_access /vendor/bin/rfs_access
    class core
    user root
    group system net_raw
    writepid /dev/cpuset/system-background/tasks

service vendor.tftp_server /vendor/bin/tftp_server
    class core
    user root
    group root system
    writepid /dev/cpuset/system-background/tasks

service port-bridge /system/bin/port-bridge
    class main
    user radio
    group radio system inet
    oneshot

# QMUX must be in multiple groups to support external process connections
service qmuxd /system/bin/qmuxd
    class main
    user radio
    group radio audio bluetooth gps nfc oem_2901
    writepid /dev/cpuset/system-background/tasks

service vendor.netmgrd /vendor/bin/netmgrd
    class main
    writepid /dev/cpuset/system-background/tasks

service vendor.ipacm-diag /vendor/bin/ipacm-diag
    class main
    user system
    socket ipacm_log_file dgram 660 system net_admin
    group net_admin oem_2901

service vendor.ipacm /vendor/bin/ipacm
    class main
    user radio
    group radio inet
    writepid /dev/cpuset/system-background/tasks

service vendor.qti /vendor/bin/qti
    class main
    user radio
    group radio net_raw oem_2901 usb net_admin
    writepid /dev/cpuset/system-background/tasks

service vendor.radio-sh /vendor/bin/init.radio.sh
    class late_start
    user radio
    group root radio
    oneshot

on property:ro.use_data_netmgrd=false
    # netmgr not supported on specific target
    stop vendor.netmgrd

# FST Manager can be started by property_set("ctl.start", "fstman:<hostap ctrl iface>");
service fstman /system/bin/fstman -B -ddd -c /data/misc/wifi/fstman.ini
    user wifi
    group wifi net_admin net_raw
    class main
    disabled
    oneshot

on property:netd.fstman.start=true
    start fstman

on property:netd.fstman.start=false
    stop fstman

service ds_fmc_appd /system/bin/ds_fmc_appd -p "rmnet0" -D
    class late_start
    group radio wifi inet
    disabled
    oneshot

on property:persist.data.ds_fmc_app.mode=1
    start ds_fmc_appd

# oneshot service that loads fpc tz app in early phase.
service fpc_early_loader /vendor/bin/fpc_early_loader
    class late_start
    user system
    group system
    oneshot

on property:init.svc.media=restarting
    restart vendor.qcamerasvr

on property:init.svc.servicemanager=restarting
    restart vendor.qcamerasvr


# Initial init.target.rc config

on early-init
    mount debugfs debugfs /sys/kernel/debug
    chmod 0755 /sys/kernel/debug
    chmod 0644 /sys/kernel/debug/rpm_stats
    chmod 0644 /sys/kernel/debug/rpm_master_stats
    chmod 0644 /sys/kernel/debug/system_stats

    export ANDROID_DATA /data
    export ANDROID_ROOT /system
    export EXTERNAL_STORAGE /sdcard

on fs
    restorecon_recursive /sns
    restorecon_recursive /persist-lg
    restorecon_recursive /mpt

    mkdir /persist/rfs 0775 root system
    mkdir /persist/hlos_rfs 0775 root system
    chmod 0775 /persist/rfs
    chmod 0775 /persist/rfs/shared
    chown system system /persist/rfs/shared
    chmod 0775 /persist/rfs/msm
    chown system system /persist/rfs/msm
    chmod 0775 /persist/rfs/msm/adsp
    chown system system /persist/rfs/msm/adsp
    chmod 0775 /persist/rfs/msm/mpss
    chown system system /persist/rfs/msm/mpss
    mkdir /persist/rfs/msm/slpi 0775 system system
    chmod 0775 /persist/rfs/mdm
    chown system system /persist/rfs/mdm
    chmod 0775 /persist/rfs/mdm/adsp
    chown system system /persist/rfs/mdm/adsp
    chmod 0775 /persist/rfs/mdm/mpss
    chown system system /persist/rfs/mdm/mpss
    mkdir /persist/rfs/mdm/slpi 0775 system system
    chmod 0775 /persist/rfs/mdm/sparrow
    chown system system /persist/rfs/mdm/sparrow
    mkdir /persist/rfs/mdm/tn 0775 system system
    chown system system /persist/rfs/apq
    chmod 0775 /persist/rfs/apq
    chown system system /persist/rfs/apq/gnss
    chmod 0775 /persist/rfs/apq/gnss
    chmod 0775 /persist/hlos_rfs

    restorecon_recursive /persist
    chown system system /persist/rfs/shared
    chown system system /persist/rfs/msm
    chown system system /persist/rfs/msm/adsp
    chown system system /persist/rfs/msm/mpss
    chown system system /persist/rfs/msm/slpi
    chown system system /persist/rfs/mdm
    chown system system /persist/rfs/mdm/adsp
    chown system system /persist/rfs/mdm/mpss
    chown system system /persist/rfs/mdm/sparrow
    chown system system /persist/rfs/mdm/tn
    chown system system /persist/rfs/apq
    chown system system /persist/rfs/apq/gnss

on post-fs
    write /sys/devices/platform/lge-qfprom/sec_read 0

on post-fs-data
    mkdir /persist/data/qc_senseid 0700 system system
    restorecon_recursive /persist
